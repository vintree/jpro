/*
    wuguzi
    wuguzix@foxmail.com
    v 1.2
*/
!function(t){function e(){}function n(){}e.initEase=function(t){var e={linear:"linear",ease:"ease","ease-out":"ease-out","ease-in":"ease-in","ease-in-out":"ease-in-out","ease-back":"cubic-bezier(0.68, -0.55, 0.27, 1.55) "};return e[t]?e[t]:t instanceof Array?(e="",e+="cubic-bezier(",e+=t.join(","),e+=")"):void 0},e.transition=function(e,n,o){var a="all "+(n/1e3||1e3)+"s "+e+" "+(o/1e3||0)+"s;";return a=t.sdPrivateProperty("transition",a)},e.transform=function(e,n){var o="",a="";return e.translate&&(o+=this.translate(e.translate,n)),e.rotate&&(o+=this.rotate(e.rotate,n)),e.skew&&(o+=this.skew(e.skew,n)),e.scale&&(o+=this.scale(e.scale,n)),e.origin&&(a+=this.origin(e.origin,n)),o+=";",o=t.sdPrivateProperty("transform",o)+a},e.translate=function(e,n){var o,a,i,r="";return o=e[0],a=e[1],i=e[2],n||(o=-1*o,a=-1*a,i=-1*i),o=t.sdIsPX(o||"0px"),a=t.sdIsPX(a||"0px"),i=t.sdIsPX(i||"0px"),r+="translate3d("+o+", "+a+", "+i+") "},e.rotate=function(e,n){var o,a,i,r,s="";return o=e[0],a=e[1],i=e[2],n||(o=-1*Number(o),a=-1*Number(a),i=-1*Number(i)),r=t.sdIsDEG(e[3]||"0deg"),s+="rotate3d("+o+", "+a+", "+i+", "+r+") "},e.skew=function(e,n){var o,a,i="";return o=t.sdIsDEG(e[0]||"0px",n),a=t.sdIsDEG(e[1]||"0px",n),i+="skew("+o+", "+a+") "},e.scale=function(t,e){var n,o,a="";return n=t[0],o=t[1],e||(n=-1*Number(n),o=-1*Number(o)),a+="scale("+n+", "+o+") "},e.origin=function(e){var n,o,a="";return n=e[0],o=e[1],a=t.sdIsPX(n)+" "+t.sdIsPX(o)+";",a=t.sdPrivateProperty("transform-origin",a)},e.animation=function(e,n){var o,a="",i="",r="",s=n.css,l=n.time||1e3,d=n.delay||0,u=e.attr("style");n&&(n.normal?(a=this.initEase(n.ease),i=this.transition(a,l,d),r=this.transform(s,!!n.normal),o=i+u+";",o+=t.sdIsBlock(e)?"display: block;":"display: inline-block;",e.attr("style",o),setTimeout(function(){e.css(s)},.06),setTimeout(function(){e.attr("style",e.attr("style")+r)},.06)):(a=this.initEase(n.ease),i=this.transition(a,l,d),r=this.transform(s,!!n.normal),o=r+u+";",e.attr("style",o),setTimeout(function(){e.css(s)},.06),o=t.sdIsBlock(e)?"display: block;":"display: inline-block;",setTimeout(function(){o+=i,e.attr("style",o+u),e.css(s)},.06)))},n.scrollDetection=function(e){var n=window.innerHeight,o=t(window).scrollTop(),a=e.scrollTop()||e[0].offsetTop,i=(e.height(),0);return n+o-i-a>0&&0>n+o-i-(a+n)?!0:!1},n.parentContainer=function(){for(var e,o,a=t.sdData.lazyOn,i=a.length,r=0;i>r;r++){var s=a[r],l=s.bindDom;for(o=s.query.length;o--;)e=t.sdData.lazyOptions[s.ouid[o]],l.is(t(document))?n.childrenContainer(s.rgDom[o],e):n.scrollDetection(l)&&n.childrenContainer(s.rgDom[o],e)}},n.childrenContainer=function(t,o){var a,i=t.length;for(a=0;i>a;a++)t[a]&&n.scrollDetection(t[a].dom)&&(e.animation(t[a].dom,o),o.repe||(t.splice(a,1),n.childrenContainer(t,o)))},n.pack=function(){n.staticLazy(),e.detection(),n.parentContainer()},n.scroll=function(){n.pack(),window.onscroll=function(){var e,o=t.sdData.lazyOn,a=t(window).scrollTop();e=(new Date).getTime(),50>a?(t.sdData.lazyOn.timestamp=e,n.pack()):e-o.timestamp>0&&(t.sdData.lazyOn.timestamp=e,n.pack())}},n.register=function(e,n){t.sdData.lazy[t.sdUuid(6)]={dom:t(e),repe:!1,css:t(e).attr("style"),view:!1,ouid:n}},n.staticLazy=function(){for(uuid in t.sdData.lazy)obj=t.sdData.lazy[uuid],dom=obj.dom,n.scrollDetection(dom)&&(options=t.sdData.lazyOptions[obj.ouid],e.animation(dom,options),delete t.sdData.lazy[uuid])},n.config=function(e,o,a){var i=e.length;if(a)for(;i--;)n.register(e[i],a);else for(;i--;)a=t.sdGroup(o),n.register(e[i],a)},n.animation=function(t,o,a){o&&(o&&o.lazy?(n.config(t,o,a),n.scroll()):e.animation(t,o))},e.detection=function(){var n,o,a,i,r,s,l,d,u,c,f,m,p,y,g,h,D=t.sdData.lazyOn,v=D.length,b=[],z=[];for(a=0;v>a;a++){for(y=t.sdData.lazyOn[a],i=y.query.length;i--;){for(s=y.query[i],r=y.ouid[i],d=y.saveDom[i],g=y.rgDom[i],l=y.bindDom,m=t.sdData.lazyOptions[r],u=d,h=t(l).find(s),p=t(l).find(s).length,o=0;p>o;o++){for(c=u.length,f=0,n=0;c>n;n++)if(u[n]&&t(u[n]).is(h.eq(o))){f=1;break}0===f&&(z=e.rgDom(h.eq(o),m,z),b.push(h[o]))}y.rgDom[i]=y.rgDom[i].concat(z),y.saveDom[i]=y.saveDom[i].concat(b)}console.log(t.sdData.lazyOn)}},e.rgDom=function(t,e,n){return n[n.length]={dom:t,css:t.attr("style"),repe:e.repe,view:e.view},n},e.arrDom=function(t){for(var e=0,n=t.length,o=[];n>e;e++)o.push(t[e]);return o},e.on=function(o,a,i){for(var r=t.sdData.lazyOn.length||0,s=o.find(a),l=s.length,d=[],u=t.sdData.lazyOn,c=t.sdData.lazyOptions[i],f=0,m=0;l--;)d=e.rgDom(s.eq(l),c,d);if(r){for(f=0;r>f;f++)if(o.is(u[f].bindDom)){m=1;break}if(0===m)u[r]={bindDom:o,saveDom:[e.arrDom(o.find(a))],query:[a],ouid:[i],rgDom:[d]},u.length=r+1,u.timestamp=(new Date).getTime(),u.tag=1;else{for(var p=u[f].query,y=p.length,g=0;y--;)if(p[y]===a){u[f].saveDom[y]=e.arrDom(o.find(a)),u[f].rgDom[y]=d,u[f].ouid[y]=i,g=1;break}console.log(g),0===g&&(u[f].saveDom.push(e.arrDom(o.find(a))),u[f].query.push(a),u[f].ouid.push(i),u[f].rgDom.push(d))}}else u[r]={bindDom:o,saveDom:[e.arrDom(o.find(a))],query:[a],ouid:[i],rgDom:[d]},u.length=r+1,u.timestamp=(new Date).getTime(),u.tag=1;n.scroll()},t.fn.extend({_animation:function(e){t("body,html").animate({scrollTop:0},10);var o=arguments.length;1===o&&(e="object"==typeof e?e:t.sdData.lazyOptions[e],n.animation(this,e))},_on:function(n,o,a){t("body,html").animate({scrollTop:0},10);var i=arguments.length;i&&(n="object"==typeof n?t.sdGroup(n):n,e.on(this,o,n,!0))},_unOrien:function(t,e){var n=t.right||-1*t.left,o=t.bottom||-1*t.top;t={time:1e3,delay:0,ease:"ease-out",css:{translate:[n,o,0],opacity:1},lazy:!!e,normal:!1},this._animation(t)},_orien:function(t,e){var n=t.right||-1*t.left,o=t.bottom||-1*t.top;t={time:1e3,delay:0,ease:"ease-out",css:{translate:[n,o,0],opacity:1},lazy:!1,normal:!0},this._animation(t)}}),t.extend({sdData:{lazy:{},lazyOptions:{},lazyOn:{}},sdPrivateProperty:function(e,n){var o=t.sdKernel(),a=""+e+": "+n,i=o+""+e+": "+n;return i+a},sdKernel:function(){var t=navigator.userAgent.toLowerCase();return t.indexOf("webkit")>=0?"-webkit-":t.indexOf("gecko")>=0?"-moz-":t.indexOf("windows")>=0?"-ms-":t.indexOf("opera")>=0?"-o-":void 0},sdIsPX:function(t){return isNaN(t)?t:t+"px"},sdIsDEG:function(t,e){return isNaN(t)?t:e?Number(t)+"deg":Number(t)+180+"deg"},sdIsBlock:function(t){var e=["address","blockquote","center","dir","div","dl","fieldset","form","h1","h2","h3","h4","h5","h6","hr","isindex","menu","noframes","ol","p","pre","table","ul"];return e=e.join(","),e.indexOf(t[0].tagName.toLowerCase())>=0?!0:!1},sdUuid:function(t){for(var e="_ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz",n=e.length,o=0,a="",i="",r=(new Date).getTime()+"";t>o;o++)a+=e.charAt(Math.floor(Math.random()*n));for(a+=r.substring(r.length-t),o=0;t>o;o++)i+=a.charAt(Math.floor(Math.random()*(2*t)));return i},sdGroup:function(e,n){var o,a=arguments.length;if(a){if(1===a&&"object"==typeof e)return n=e,o=t.sdUuid(6),t.sdData.lazyOptions[o]=n,o;if(2===a&&"string"==typeof e&&"object"==typeof n)return t.sdData.lazyOptions[e]=n,e}},sdCleanGroup:function(e){delete t.sdData.lazyOptions[e]},sdGetOption:function(e){return"string"==typeof e&&(e=t.sdData.lazyOptions[e]),e}})}(jQuery||Zepto);
